<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>如何实现一个强大的 MMO 技能系统 | Tamsiree</title><meta name="author" content="Tamsiree,tamsiree.com@gmail.com"><meta name="copyright" content="Tamsiree"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="技能系统可以说是游戏中广泛存在而又最重要的系统了，它是整个游戏战斗体验的核心。一套强大的技能系统可以让游戏的策略性，可玩性得到极大的提升。然而技能系统牵涉到的模块非常多，又会面对策划各种各样的奇葩需求，同时技能模块中很多系统的设计不仅仅对程序员的编码能力提出了一定的要求，而且还需要程序员对游戏机制有着深入的理解。可以说要实现一套强力的高可用高扩展的技能系统还是有一定复杂度的。">
<meta property="og:type" content="article">
<meta property="og:title" content="如何实现一个强大的 MMO 技能系统">
<meta property="og:url" content="https://tamsiree.com/Game/MMO/%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E5%BC%BA%E5%A4%A7%E7%9A%84MMO%E6%8A%80%E8%83%BD%E7%B3%BB%E7%BB%9F/">
<meta property="og:site_name" content="Tamsiree">
<meta property="og:description" content="技能系统可以说是游戏中广泛存在而又最重要的系统了，它是整个游戏战斗体验的核心。一套强大的技能系统可以让游戏的策略性，可玩性得到极大的提升。然而技能系统牵涉到的模块非常多，又会面对策划各种各样的奇葩需求，同时技能模块中很多系统的设计不仅仅对程序员的编码能力提出了一定的要求，而且还需要程序员对游戏机制有着深入的理解。可以说要实现一套强力的高可用高扩展的技能系统还是有一定复杂度的。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Tamsiree/Assets@master/Picture/Blog/Cover/bg-b14c061.jpg">
<meta property="article:published_time" content="2020-10-15T07:00:21.000Z">
<meta property="article:modified_time" content="2025-11-05T13:53:39.403Z">
<meta property="article:author" content="Tamsiree">
<meta property="article:tag" content="Game">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Tamsiree/Assets@master/Picture/Blog/Cover/bg-b14c061.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "如何实现一个强大的 MMO 技能系统",
  "url": "https://tamsiree.com/Game/MMO/%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E5%BC%BA%E5%A4%A7%E7%9A%84MMO%E6%8A%80%E8%83%BD%E7%B3%BB%E7%BB%9F/",
  "image": "https://cdn.jsdelivr.net/gh/Tamsiree/Assets@master/Picture/Blog/Cover/bg-b14c061.jpg",
  "datePublished": "2020-10-15T07:00:21.000Z",
  "dateModified": "2025-11-05T13:53:39.403Z",
  "author": [
    {
      "@type": "Person",
      "name": "Tamsiree",
      "url": "https://tamsiree.com"
    }
  ]
}</script><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/Tamsiree/Assets@master/Avatar/avatar_sky_circle.png"><link rel="canonical" href="https://tamsiree.com/Game/MMO/%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E5%BC%BA%E5%A4%A7%E7%9A%84MMO%E6%8A%80%E8%83%BD%E7%B3%BB%E7%BB%9F/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="manifest" href="/manifest.json"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"/><link rel="stylesheet" href="/css/index.css?v=5.5.3"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.7/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')

          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: 'ca-pub-8688374801147098',
  enable_page_level_ads: 'true'
});</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"pagination":{"enable":false,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Tamsiree","link":"链接: ","source":"来源: Tamsiree","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: true,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '如何实现一个强大的 MMO 技能系统',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><script>if (window.location.protocol !== 'https:' && window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') { window.location.href = window.location.href.replace('http:', 'https:'); }</script><meta name="generator" content="Hexo 8.1.1"><link rel="alternate" href="/atom.xml" title="Tamsiree" type="application/atom+xml">
</head><body><div class="bg-animation" id="web_bg" style="background-color: #f0f0f0;"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/images/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Tamsiree/Assets@master/Avatar/avatar_sky_circle.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">201</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">140</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">143</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-keyboard"></i><span> 目录</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-torah"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-leaf"></i><span> 风向标</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-dragon"></i><span> 寻龙尺</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-icons"></i><span> 回味</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-camera-retro"></i><span> 画廊</span></a></li><li><a class="site-page child" href="/book/"><i class="fa-fw fas fa-book"></i><span> 书屋</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 神秘链接</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-clipboard-list"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-id-badge"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/night_sky/"><i class="fa-fw fas fa-magic"></i><span> 冥想空间</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/Tamsiree/Assets@master/Picture/Blog/Cover/bg-b14c061.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Tamsiree</span></a><a class="nav-page-title" href="/"><span class="site-name">如何实现一个强大的 MMO 技能系统</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-keyboard"></i><span> 目录</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-torah"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-leaf"></i><span> 风向标</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-dragon"></i><span> 寻龙尺</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-icons"></i><span> 回味</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-camera-retro"></i><span> 画廊</span></a></li><li><a class="site-page child" href="/book/"><i class="fa-fw fas fa-book"></i><span> 书屋</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 神秘链接</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-clipboard-list"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-id-badge"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/night_sky/"><i class="fa-fw fas fa-magic"></i><span> 冥想空间</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">如何实现一个强大的 MMO 技能系统</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-10-15T07:00:21.000Z" title="发表于 2020-10-15 15:00:21">2020-10-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-11-05T13:53:39.403Z" title="更新于 2025-11-05 21:53:39">2025-11-05</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Game/">Game</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Game/MMO/">MMO</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">13.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>42分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="1-如何实现一个强大的-MMO-技能系统——序章"><a href="#1-如何实现一个强大的-MMO-技能系统——序章" class="headerlink" title="1. 如何实现一个强大的 MMO 技能系统——序章"></a>1. 如何实现一个强大的 MMO 技能系统——序章</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>技能系统可以说是游戏中广泛存在而又最重要的系统了，它是整个游戏战斗体验的核心。一套强大的技能系统可以让游戏的策略性，可玩性得到极大的提升。然而技能系统牵涉到的模块非常多，又会面对策划各种各样的奇葩需求，同时技能模块中很多系统的设计不仅仅对程序员的编码能力提出了一定的要求，而且还需要程序员对游戏机制有着深入的理解。可以说要实现一套强力的高可用高扩展的技能系统还是有一定复杂度的。</p>
<p>如果作为一个游戏玩家，谈论到技能系统，我们一定会对 War3 的技能编辑器印象深刻，通过设计一个高扩展的技能系统编辑器，它打造了无数的经典游戏。各种对战地图，RPG 守图，TD 塔防，趣味闯关，甚至产生了其中最经典的风靡全球的 Dota，为我们展示了 War3 技能系统的强大。后来 Valve 甚至因此专门开发了 Dota2，而且它提供了更强大的地图编辑器，基于该编辑器开发的自走棋更是开创了一个新的游戏品类。这就是技能系统所展现的魅力。</p>
<p>如果论网络游戏领域技能系统之集大成者，相信魔兽世界，守望先锋，Dota2 都可占得一席之地。深入玩过这几款游戏的话，都会被他们技能系统之精巧所震撼。但是前两款游戏的技术分享实在太少，所流传在外的资料并不足以让人去深入研究他们的技能系统的架构是怎样的。而 Dota2 因为地图编辑器的存在，有大量的资料可以去获取 [1][2]。你甚至可以直接写一个技能脚本去运行一下，验证自己的猜测是否正确。本人的技能系统实现，可以说极大的受益于此，正因为有着可以大量阅读的文档和技能示例，才让我对技能系统的认识有了质的飞跃，在此深表感谢。</p>
<p>互联网上关于游戏开发相关的技术文章浩若烟海，佳作繁多，本人也因此所获良多，受益匪浅。然而对于技能系统设计这块尚有遗珠之憾，本系列的文章将围绕如何打造一个强大的 MMO 技能系统这个主题展开，对技能系统涉及到的各个模块一一详细讲解，从而让读者对技能系统有深入的了解和认识。</p>
<p>本系列将技能系统分为如下模块依次讲解：</p>
<ol>
<li>AOI 系统</li>
<li>技能（Ability)</li>
<li>Buff</li>
<li>子弹（Projectile）</li>
<li>特效</li>
<li>运动</li>
<li>动画</li>
</ol>
<h1 id="2-如何实现一个强大的-MMO-技能系统——AOI"><a href="#2-如何实现一个强大的-MMO-技能系统——AOI" class="headerlink" title="2. 如何实现一个强大的 MMO 技能系统——AOI"></a>2. 如何实现一个强大的 MMO 技能系统——AOI</h1><h2 id="前言-1"><a href="#前言-1" class="headerlink" title="前言"></a>前言</h2><p>AOI（area of interest），它是 MMO 游戏中一个极其重要的概念，主要解决游戏中多人同屏的问题。本文并不打算去讲 AOI 相关的算法，如九宫格，十字链表，六边形网格之类的具体算法实现，因为此类文章网络上已经有很多了。虽然大多数开发者都接触过 AOI，但是我发现其中很多人并没有真正深入领会 AOI 的本质。因此本文会从设计的角度来阐释什么是 AOI，为什么要有 AOI，以及如何去设计一个高质量的 AOI 系统。</p>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><p>很多开发者在设计 AOI 系统的时候通常是这样设计的（以最常见的九宫格为例），比如把场景按照一定的 Size 划分出很多格子，然后由 AOI 系统根据玩家位置来更新玩家的所在的网格索引，每个玩家获取周围 9 个格子的玩家信息来进行显示。</p>
<p>这样就在细节上出现了很多如下问题：</p>
<ol>
<li>玩家位置变化的时候如何处理，立即更新或者等到下一帧 update 的时候更新？</li>
<li>玩家位置变化或者周边其他玩家变化导致所在网格索引变化后，带来的对象的增加、删除如何处理？</li>
<li>由于显示列表的容量限制，玩家 A 的显示列表里面添加了玩家 B，但此时玩家 B 的显示列表满了，该怎么处理呢？</li>
</ol>
<p>这样的问题林林总总，很多开发者都花了不少心思去处理这样的问题。但是请让我们更深入的考虑一下，为什么会出现这样的问题呢？这样的设计就够了吗？</p>
<p>又比如说某天策划脑洞大开，说我们来做个暗杀玩法吧。并绘声绘色地给你描绘了如下让人心潮澎湃的情境：</p>
<p>“你从酒馆老板处接到暗杀任务后，展开羊皮纸一看，上面只记录了目标所在的场景，并没有具体位置信息，你需要传送到目标场景之后，自己去发现目标的踪迹。于是你使用传送卷轴到达了目标所在的场景，然后站在高山之上，开启了鹰眼术，目光如电刺穿远方层层的迷雾，随着你细致地搜寻，突然间发现远方的天际一个黑点缓缓浮现，你知道他就是此次的任务目标了，随即你立刻翻身上马，向目标疾驰而去……”</p>
<p>那这个时候作为程序，你该如何实现这个需求呢？</p>
<p>很明显，此时目标离你的距离远超你九宫格的距离，你依然要将他显示出来。那这个时候该怎么办呢？</p>
<p>所以，我们顺其自然地有了一个新的概念——“关注者“，AOI 搜寻到的列表并不能就完全等同于关注者列表。而客户端显示的就是关注者列表里面的内容。AOI 搜寻到的列表只是用来获得关注者的手段。</p>
<p>为了让读者有个更直观的理解，我举个例子。大家都很熟悉微博，假如我们把游戏当作微博来看的话。</p>
<ol>
<li>登录场景：当我们注册账号进入微博（游戏场景）的时候，大家都没有关注者。这个时候我的微博首页的时间线上没有任何其他人的动态（游戏中此时只看得到自己）。</li>
<li>获得其他玩家信息：这个时候为了让大家互相交互，微博提供了附近的人的选项（假设微信上的这个功能移动到了微博）。这个时候你点击附近的人（游戏中向 AOI 系统拉取周边九宫格的玩家列表），然后获得了一系列的用户信息列表。此时你一一关注，瞬间你的时间线动态就丰富了起来（关注者列表新增周边的玩家并显示在本地客户端）。</li>
<li>消息同步：假设你的用户名是 A，并且你关注了 B，C。那么此时你的关注者列表里面是 BC。而 BC 此时并不会说就关注你了，而是收到系统通知，获得了新的粉丝 A。那么我们现在看 A 的时间线，会不停的收到 B 和 C 的动态，如果是在游戏场景下，那么 B 和 C 最常发送的动态就是玩家 B 或 C 移动到了某位置 P1（Obj:MultiCastPktPosChanged)，玩家 B 或 C 使用了技能（Obj:MultiCastPktCastAbility)等等（此处仅为让读者能够直观理解概念，实际上的同步优化处理有很多方法和技巧，在此并不展开）。</li>
<li>关注机制：虽然上例中 A 能收到 B 和 C 的各种动态，但是 A 发出来的动态只有自己看的到，B 和 C 是看不到的，也就是说 AOI 并不需要双向连接。这并不仅仅只是为了解决前面提到的第 3 个问题（细细思考一下）。同时这也是符合现实感受的。比如说每天上班的时候地铁里面有很多人，你会关注谁呢，你关注的目标会关注你吗？但此时如果周围有人拍了一下你的肩膀，喊了你的名字，那么你就会立即关注他是谁，对吧。（以游戏场景为例的话，假如周边有很多玩家的话，你不一定需要严格按照位置远近来排序，而是需要把跟你关联度最高的玩家加到你的关注者列表中。比如不远处的某个玩家向你发起了切磋请求，那么此时的解决方案就应该是把他加入到你的关注者列表，而不会说根据距离远近再来把这个玩家增添移除掉）。</li>
</ol>
<p>此时，回到最开始的问题，那么前面的问题的答案就显而易见了。</p>
<ol>
<li>AOI 的信息需要立即更新吗？不一定需要，我们未必需要时时刻刻关注离我最近的目标，附近的人这个功能里面的用户列表更新频率慢一点也没关系。</li>
</ol>
<p>2. 因为我们并不需要时时刻刻关心附近的人，所以自然也不会有某个玩家在边界进进出出导致的 AOI 不停的创建和删除的开销问题。（如果还需要优化就加上 lazy time 处理下吧）</p>
<p>3. 这个问题已经显而易见了，没必要一定得互粉，看缘分啦。我附近如果没其他人，又太寂寞的话说不定也会关注你，关注列表满了就算了。</p>
<p>最后，策划的需求解决起来也很简单了。搜寻目标的过程就是使用技能给自己加了个 Buff，Buff 创建的时候将目标加到关注者列表中，目标死了后 buff 销毁，并将目标移除出关注者列表。这在微博系统中相当于你直接搜索该玩家的账号，直接加关注，任务达成后再直接取关就行了。并不需要与”附近的人“这个功能发生任何关系。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>因此，当我们设计 AOI 系统的时候，并不需要严格只显示九宫格范围内的对象，九宫格只是一个手段，一个让我们获得关注者的手段，它只是个过程，并不是结果。大家在设计的时候多考虑这一点，使用起来就方便很多了。甚至我们可以让技能改变关注者列表，从而达成一些特殊效果。</p>
<h1 id="3-如何实现一个强大的-MMO-技能系统——技能"><a href="#3-如何实现一个强大的-MMO-技能系统——技能" class="headerlink" title="3. 如何实现一个强大的 MMO 技能系统——技能"></a>3. 如何实现一个强大的 MMO 技能系统——技能</h1><h2 id="前言-2"><a href="#前言-2" class="headerlink" title="前言"></a>前言</h2><p>一个完整的技能系统逻辑层主要包括三个模块：技能模块，buff 模块，projectile（子弹）模块。然而在很多项目中，这三个模块可能并不是同一个人负责的，所以会发现这些模块间的联系并不够紧密，然而技能的需求是非常复杂的，这样就有可能随着技能需求的越来越复杂，每个模块都搞了一套自己的脚本化的逻辑，最后维护难度急剧增加，导致开发成本大大提高。本章将主要讲述一个高扩展性的技能模块该如何设计，使得技能支持尽可能多的效果，同时又能够保持架构的精简和高扩展性。</p>
<h2 id="正文-1"><a href="#正文-1" class="headerlink" title="正文"></a>正文</h2><p>首先，我们大致思考一下平常玩的游戏，大致会发现有如下几种技能类型：</p>
<ol>
<li>被动类型的技能(PassiveAblity)</li>
<li>主动施法技能（最常见的通用主动施法类技能，如普通攻击等一次性触发效果类技能（GeneralAbility），引导类持续施法技能(ChannelAbility)，如大法师暴风雪）</li>
<li>开关类技能（(ToggleAbility)点击技能开启 / 关闭效果，类似于恶魔猎手献祭）</li>
<li>激活类技能（(ActivateAbility)点下右键激活 / 停止，一般是给普通攻击附加特殊效果）</li>
</ol>
<p>在这里我们采用标记位（可进行或操作）的形式来表明这些技能的类型。这意味着一个技能可能被检测既是被动又是引导类技能（我们将在最后的示例部分讲述为什么需要这样设计）。</p>
<p>下面我们一步步讲解这些技能类型该如何设计。在我们的技能系统中，所有的技能里面不包含任何具体技能效果及逻辑，每个技能根据其类型提供若干抽象接口，具体执行效果由策划去配置。</p>
<p>当一个技能标记为被动技能时，则它是被动技能，被动技能一般会在技能初始化时生效，技能初始化时会有抽象行为接口 Ability::OnAbilityInit()。那么被动技能就可以在这个接口中执行一些行为，具体执行那些功能由策划配置，一般情况下策划会配置给角色添加 Buff 来监听各种事件以触发各种效果。那么技能的各种效果该如何实现呢？我们将在下一章 buff 系统中讲到。</p>
<p>当一个技能标记为主动施法的技能时，它可手动释放，同时在施法前需要有目标信息，这里一般有三种情况：</p>
<ol>
<li>技能释放时不需要目标即可释放（如群疗，踩地板技能） -&gt; 1 &lt;&lt; 1</li>
<li>技能释放时需要选定目标（单体指向性技能） -&gt; 1 &lt;&lt; 2</li>
<li>技能释放时需要以指定地点为目标（常用于 AOE 技能） -&gt; 1 &lt;&lt; 3</li>
</ol>
<p>虽然技能系统千变万化，但是初始阶段选择目标就是这三种情况的组合。有些复杂的技能会有两种组合情况：</p>
<p>比如策划有个需求是闪现技能，如果当前没有选择目标就朝前方闪现五米，有目标时则闪现到目标身后。则我们的目标选择配置项就是 1|2，当释放技能的时候我们保存下当前的目标信息（有无目标），后续在技能效果执行的时候去获取目标是否存在，然后实现不同的效果。（Dota2 中 Lion 的穿刺和先知的招树就是 2|3。）</p>
<p>如果标记为普通施法技能，我们将技能划分为如下几个阶段：</p>
<p><img src="/images/loading.gif" data-lazy-src="https://pic3.zhimg.com/80/v2-dab99247f856a3a9a2f4903e6214e70e_720w.jpg"></p>
<p>当我们满足技能释放的各种前置条件检查后，会进入如下几个阶段：</p>
<ol>
<li>技能起手 Ability::OnAbilityStart()，这个时候通常情况下策划一般配置为播放动画，技能开始转 CD，执行完成后技能进入前摇阶段。</li>
<li>技能前摇阶段不允许其他技能释放，除非技能可强制立即释放（bImmediately=true）（如有些游戏要求滚动还有解控技可以立即打断当前技能）。前摇阶段提供一个配置时长 CastPoint(Spell 时间点）, 一般为动画抬手到攻击帧时长。比如说播放一个挥刀动画 0.3 秒后动画到攻击点，这时策划就配置 CastPoint 为 0.3 秒。</li>
<li>Spell 阶段一般为技能具体逻辑执行阶段。通常会根据配置选择相应目标造成相应效果。当执行完操作之后进入后摇阶段。</li>
<li>后摇阶段一般不能被其他技能打断，除非是连招或者强制立即释放类技能。我们的技能系统不需要引入公共 CD 这个概念，通过前摇后摇阶段的划分就足够满足各种需求了。</li>
</ol>
<p>如果标记为持续施法类技能(Channel)，我们将技能分为如下几个阶段：</p>
<p><img src="/images/loading.gif" data-lazy-src="https://pic1.zhimg.com/80/v2-a002cbcc53c737350c68063f7ab58288_720w.jpg"></p>
<ol>
<li>起手前摇阶段同普通技能。</li>
</ol>
<p>2. 引导阶段提供 3 个接口供策划配置逻辑(ChannelStart, ChannelThink, ChannelFinish），提供两个时间参数以供配置：ThinkInterval （引导触发间隔）及 ChannelTime（引导阶段总时长）。如策划配置 CastPoint 为 0.1 秒，ThinkInterval 为 0.3 秒，ChannelTime 为 1.4 秒时。则技能将会在 AbilityStart0.1 秒后调用 ChannelStart, 将在第 0.4 秒 -&gt;0.7 秒 -&gt;1.0 秒 -&gt;1.3 秒调用 ChannelThink，将在第 1.5 秒调用 ChannelFinish。这样的接口设计在保证简洁的情况下基本能覆盖几乎所有的需求。</p>
<ol start="3">
<li>后摇阶段同普通技能。</li>
</ol>
<p>如果标记为开关类技能，我们提供两个接口：OnAbilityToggleOn 和 OnAbilityToggleOff，一般通过调用添加 / 移除 buff 实现具体效果。</p>
<p>如果标记为激活类技能，我们提供两个接口：OnAbilityActivate 和 OnAbilityDeactivate，一般通过调用添加 / 移除 buff 实现具体效果。</p>
<h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><p>本章主要讲述技能的类型和阶段划分。通过良好的阶段划分和逻辑抽象就可以让技能有非常高的扩展性，这样在后续的开发中仅仅只需要做一些功能的扩展，而不会影响整体的架构。</p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>我会举出一些常见而特殊的技能例子，以便让读者有个直观的理解。</p>
<ol>
<li>问：如果被动触发后会进入 CD，此时被动不再生效如何实现？（Dota2 白牛重击效果）答：策划在被动触发时配置 StartCooldown(duration)即可，技能的 CD 是个可配置行为，执行 StartCooldown 就转 CD，什么技能都能走 CD，而且可以在任意情况下走 CD。走不走 CD 策划看着配就行。技能走 CD 后然后在被动行为里面检测技能是否在 CD 状态，如果在 CD 状态则不执行任何效果。</li>
<li>问：技能既可以主动释放又能有被动效果如何实现？(Dota2 敌法师护盾）答：被动效果其实是由 Buff 具体负责监听各类事件触发效果，主动技能也能在 OnAblityInit 的时候执行行为，策划在此处配置加 buff 就行了。那么问题继续来了，如果有一个效果是禁用被动技能的话，前面的带被动效果的主动类型技能该不该禁用呢？答：这时候技能类型为标记为位（bit)的作用就体现出来了，如果标记为被动 (AbilityFlag &amp; AbilityPassive 为 true) 的话就禁用。</li>
<li>问：蓄力类技能也是一种常见的技能类型啊，为什么没有被提到？答：蓄力类技能在我们的技能系统中直接简化为普通技能了。它只需要策划在技能抬手的时候播一个蓄力动画，然后 CastPoint 配成蓄力时长，在 Spell 的时候再播一个动画就行了。继续问：那蓄力后的攻击动画到攻击效果还有一个间隔时长怎么办？继续答：配置技能为引导类技能，例如配置 ChannelInterval 为 10000 秒，ChannelTime 为 0.3 秒，这样技能引导阶段就只调用 ChannelFinish，蓄力的效果在 ChannelFinish 里面触发即可。</li>
<li>问：各类轻功，击退，击飞，冲刺攻击等各种位移效果怎么实现，他们之间万一存在各种复杂的打断规则又怎么处理？答：我们通过 Buff 去改变角色运动，状态，属性等。下一章将会具体讲述这些情况。</li>
</ol>
<h1 id="4-如何实现一个强大的-MMO-技能系统——BUFF"><a href="#4-如何实现一个强大的-MMO-技能系统——BUFF" class="headerlink" title="4. 如何实现一个强大的 MMO 技能系统——BUFF"></a>4. 如何实现一个强大的 MMO 技能系统——BUFF</h1><h2 id="前言-3"><a href="#前言-3" class="headerlink" title="前言"></a>前言</h2><p>Buff 模块可以说是技能中最核心又最复杂的系统了。一个优秀的 Buff 系统能够让策划的创意得到最大限度的发挥，大幅增强游戏的战斗深度和可玩性，并且同时也能让开发者轻易的扩展维护，支持更多的效果和功能。本章将为你详细讲述一个强大的 Buff 系统是如何实现的。（长文预警）</p>
<h2 id="正文-2"><a href="#正文-2" class="headerlink" title="正文"></a>正文</h2><h3 id="第一节：Buff-定义"><a href="#第一节：Buff-定义" class="headerlink" title="第一节：Buff 定义"></a>第一节：Buff 定义</h3><p>首先我们将 Buff 系统分为三个层次，具体继承关系如下：</p>
<p><img src="/images/loading.gif" data-lazy-src="https://pic4.zhimg.com/80/v2-fbac31f1aed84bb08ba0df09f73b6117_720w.jpg"></p>
<p>Buff：所有 Buff 的基类，包含各类成员函数和基本接口。</p>
<p>Modifier：继承于 Buff，代表这个 Buff 是一个修改器，它可以用来修改当前目标的各种属性，状态等等。抽象 Modifier 这个类的目的是出于性能优化的考虑。因为当 Buff 修改角色的属性或者状态时，会导致重新计算角色的动态属性， 而在游戏中我们很多的 Buff 并不需要修改角色的属性状态，仅仅用来提供一段逻辑。那么如果它是一个 Buff 不是 Modifier，就不需要重新计算角色的动态属性。</p>
<p>MotionModifier：继承于 Modifier，代表此类 Buff 提供修改玩家运动效果的功能。因为牵涉到与运动组件的交互，所以抽象出一个新的类。</p>
<p>Buff 类层次结构划分了之后，那么 Buff 需要包含那些成员数据呢？</p>
<p>我们提供 BuffTypeId(Buff 类型 Id)， Caster（Buff 施加者），Parent（Buff 当前挂载的目标）, Ability(Buff 由哪个技能创建)，BuffLayer（层数）, BuffLevel（等级）BuffDuration（时长），BuffTag，BuffImmuneTag（免疫 BuffTag）以及 Context(Buff 创建时的一些相关上下文数据)等等。</p>
<p>在这里，我将说明一下 Caster，Ability 以及 Context 这三个成员，这也可能是我们 Buff 系统中一些独特的点。</p>
<p>Caster 代表 Buff 的施加者，它有可能为空，也有可能不为空，视具体构造时是否传 Caster 参数而定。但是 Buff 有一个配置项 bNoCaster（是否强制设置 Caster 为空）。如果 bNoCaster = true。则 Buff 的 Caster 一定为空。</p>
<p>为什么要有一个 bNoCaster 设置呢？那是因为我们的 Caster 不仅仅是一个成员项，它还关系到 Buff 合并问题。如果存在两个 TypeId 类型相同的 Buff 时候，当他们的 Caster 相同才可以走合并流程（Buff 层数增加），如果 Caster 不同，则不能合并。当策划有一些玩法需求可以多人给 BOSS 叠 Buff 时就可以配置 Buff 的 bNoCaster=true，这样就不需要开发者在写代码添加 Buff 的时候小心翼翼的设置 Caster 参数为空了。另外还有几种情况也需要设置 bNoCaster=true，比如存在一个熔岩地图，或者冰雪地图，玩家每秒掉多少血量，这个时候也可以配置 bNoCaster=true。再比如说一些活动 buff，如双倍经验 buff，红名惩罚 buff，都可以由策划配置 bNoCaster=true。类似于双倍经验，还有红名 Buff 这种所有需要存盘的 Buff，我们都需要设置 bNoCaster=true。也许会有人有疑问，这样能满足需求吗？完全可以，我会在最后的示例部分举出一个例子来解答这个疑问。</p>
<p>Ability 代表 Buff 是由哪个技能创建，它有可能为空，也有可能不为空，视具体构造时是否传 Ability 参数而定。通过 Ability 这个成员类型，我们就将 Buff 与技能联系起来了，我们能在 Buff 中取得技能的各种数据，通过获取技能的数据，然后由 Buff 来实现各种各样的技能效果。</p>
<p>BuffTag，BuffImmuneTag 由策划配置(基于标记位），标注这个 Buff 属于那些种类以及免疫哪些种类。策划可以定义一些 Tag 如下：</p>
<ol>
<li>Metal = 1 &lt;&lt; 1 （金系）</li>
<li>Wood = 1 &lt;&lt; 2（木系）</li>
<li>Water = 1 &lt;&lt; 3（水系）</li>
<li>Fire = 1 &lt;&lt; 4（火系）</li>
<li>Earth = 1 &lt;&lt; 5（土系）</li>
</ol>
<p>当策划配置 BuffTag 为 Meta | Wood 时，则代表这个 Buff 归属为金系和木系 Buff。如果策划配置 BuffImmuneTag 为 Wood | Fire 时，则代表这个 Buff 可以免疫所有木系和火系 Buff。由于 Tag 的实际定义由策划控制，策划可以根据他们的需求组合出各种各样的免疫效果。我将在后面的示例里面描述一些基于 Tag 和 ImmuneTag 用法的例子来让读者体会 Tag 和 ImmuneTag 者两个概念抽象的简洁之美。</p>
<p>Context 代表 Buff 创建时候的一些上下文数据，它是一个不确定的项，通过外部传入各种自定义的数据，然后在 Buff 逻辑中使用这些自定义数据。</p>
<h3 id="第二节：Buff-执行流程"><a href="#第二节：Buff-执行流程" class="headerlink" title="第二节：Buff 执行流程"></a>第二节：Buff 执行流程</h3><p>在 Buff 从创建到销毁的过程中，我们划分为如下几个阶段：</p>
<ol>
<li>Buff 创建前检查当前 Buff 是否可创建。一般主要是检测目标身上是否存在免疫该 Buff 的相关 Buff，如果被免疫则不会创建该 Buff。</li>
<li>Buff 在实例化之后，生效之前（还未加入到 Buff 容器中）时会抛出一个 OnBuffAwake 事件。如果存在某种 Buff 的效果是：受到负面效果时，驱散当前所有负面效果，并给自己加一个护盾。那么这个时候就需要监听 BuffAwake 事件了，此时会给自己加护盾，并且把所有负面 Buff 驱散。这意味着一个 Buff 可能还未生效之前即销毁了（小心 Buff 的生命周期）。</li>
<li>当 Buff 生效时（加入到 Buff 容器后），我们提供给策划一个抽象接口 OnBuffStart，由策划配置具体效果。</li>
<li>当 Buff 添加时存在相同类型且 Caster 相等的时候，Buff 执行刷新流程（更新 Buff 层数，等级，持续时间等数据）。我们提供给策划一个抽象接口 OnBuffRefresh，由策划配置具体效果。</li>
<li>当 Buff 销毁前（还未从 Buff 容器中移除），我们提供给策划一个抽象接口 OnBuffRemove，由策划配置具体效果。</li>
<li>当 Buff 销毁后（已从 Buff 容器中移除），我们提供给策划一个抽象接口 OnBuffDestroy，由策划配置具体效果。</li>
<li>Buff 还可以创建定时器，以触发间隔持续效果。通过策划配置时调用 StartIntervalThink 操作，提供 OnIntervalThink 抽象接口供策划配置具体效果。</li>
<li>Buff 还可以通过请求改变运动来触发相关效果。通过策划配置时调用 ApplyMotion 操作，提供 OnMotionUpdate 和 OnMotionInterrupt 接口供策划配置具体效果。</li>
</ol>
<p>Buff 由于其有着生命周期可控，低耦合（通过监听事件修改逻辑），高内聚、易于扩展的特性，因此通过使用 Buff 来管理逻辑的话，不仅方便处理各种复杂的行为，同时还能有效的减少开发者的维护难度。</p>
<p>例如延迟触发伤害是游戏中非常常见的需求，在一些开发者的设计中就是直接给角色挂个定时器触发伤害。简单的游戏里这样做没什么大问题，但是如果技能逻辑稍微复杂点，这样就会带来很多问题。例如某天策划提出需求，如果受到控制效果时需要取消该延迟伤害。此时你怎么办，直接干掉 timer？结果策划过了两天又提出了个新的需求，还是受到控制效果时，需要这个延迟伤害立即触发，你又怎么办？再又比如说，当角色受到伤害超过 1000 点时，这个延迟伤害立即触发，你又该怎么做？</p>
<p>这里就体现出 Buff 的方便之处了，我们可以直接添加一个持续时间为 N 秒的 Buff。Buff 销毁时触发伤害。如果需求变更为受到控制时取消伤害，那么我们就在 Buff 中检查当前是否包含有 Tag 为 Control 的 Buff。如果有，则设置 Buff.bTriggerDamage=false，同时自我销毁。然后在 BuffDestroy 触发的时候检查是否触发伤害，如果 bTriggerDamage 为 false 则不触发伤害。同理，当需求为 Buff 监听伤害超过 1000 点伤害立即触发时，我们只需要通过 Buff 监听 OnTakeDamage 事件，检查当前受到的伤害值是否大于 1000 点，如果是则销毁 Buff，此时立即触发 BuffDestroy 并执行伤害效果。</p>
<p>从上面的例子我们可以看出整个控制逻辑都是在 Buff 内部完成的，不需要各种手动开启 / 取消定时器。只需要 Buff 扩展下逻辑检查即可，具有非常好的扩展性和高内聚性。</p>
<h3 id="第三节：Buff-修改状态（ModifyState"><a href="#第三节：Buff-修改状态（ModifyState" class="headerlink" title="第三节：Buff 修改状态（ModifyState)"></a>第三节：Buff 修改状态（ModifyState)</h3><p>Buff 可以通过修改状态去影响角色行为逻辑。以下列举一些最常见的状态：</p>
<ol>
<li>Stun（眩晕状态——目标不再响应任何操控）</li>
<li>Root（缠绕，又称定身——目标不响应移动请求，但是可以执行某些操作，如施放某些技能）</li>
<li>Silence （沉默——目标禁止施放技能）</li>
<li>Invincible (无敌——几乎不受到所有的伤害和效果影响）</li>
<li>Invisible (隐身——不可被其他人看见）</li>
</ol>
<p>这些状态是高度凝练的精华，抽象到极致的代表。非常多的游戏效果实际上都是这几种状态 + 运动 + 动画的组合。这里很多开发者都会有一个设计误区就是把 Buff 的状态跟运动和动画耦合在一块，比如：眩晕状态一定就是播个眩晕动画，然后击退状态就是击退位移 + 击退动画。这样最后导致的问题就是状态膨胀，而且各种逻辑耦合，Bug 频出，最后维护成本大大提高。</p>
<p>以 Stun 为例，很多人第一眼看过去就觉得它是个 Debuff，是个敌人给我方加的控制 Buff。实际上并非如此，Stun 可以用到的地方非常多。例如有个技能是野蛮冲撞，释放后 2 秒内向前移动 10 米并将敌人推开。那这个 Buff 的实现就是技能 Spell 的时候给角色加个 Buff，这个 Buff 会有个 Stun 状态同时带位移突进效果。挂上这个 Buff 后，技能施放后角色 2 秒内就不会响应角色按键移动和释放其他技能的请求了，同时往前突进的效果由 Buff 控制，将来处理各种位移打断效果也很方便。再比如说有个技能叫寒冰屏障：你被一道寒冰屏障所笼罩，在十秒内不会受到任何物理和法术伤害，但这期间无法移动、攻击或施法。那这个技能的实现也很简单，就是一个十秒的 Buff 同时添加了眩晕和无敌这两个状态，如果还需要每秒回血，则 StartIntervalThink(interval)，然后 OnIntervalThink 的时候 Heal 当前角色即可。</p>
<p>除了各类战斗效果之外，我们的 Buff 甚至可以扩展到一些其他场景。比如说打 BOSS 前有个播过场动画的需求，此时策划希望隐藏 Boss 和玩家的血条和姓名。那么此时我们完全可以做个 Buff，这个 Buff 扩展个状态 HideHpBar，当有这个状态时即隐藏血条和名字就行了。而且我们还可以让这个 Buff 加上无敌状态，毕竟播过场动画的时候我们不希望玩家或者 BOSS 真的受到什么伤害。</p>
<p>总而言之，Buff 状态除了上面提到几种高度凝练抽象的状态外，我们还可以根据具体游戏的需求去扩展各种特殊状态，以满足策划的需求，同时方便开发者管理逻辑。</p>
<h3 id="第四节：Buff-修改属性-ModifyAttribute"><a href="#第四节：Buff-修改属性-ModifyAttribute" class="headerlink" title="第四节：Buff 修改属性(ModifyAttribute)"></a>第四节：Buff 修改属性(ModifyAttribute)</h3><p>在游戏中 Buff 的添加与移除是一个频繁的过程。而玩家的属性来源有很多，如等级，装备，成就，任务，时装等等各种各样的来源。相比于 Buff，这些模块修改属性的频率要远低于 Buff，所以我们一般将玩家的属性划分为两层，第一层时 Core（核心层），第二层是 External（外部层）。Core 层是玩家各个其他模块的属性总和，而 External 层则是 Buff 修改属性的总和。两者相加既为玩家的实时属性。</p>
<p><img src="/images/loading.gif" data-lazy-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="></p>
<p>图文无关</p>
<h3 id="第五节：Buff-修改运动-ModifyMotion"><a href="#第五节：Buff-修改运动-ModifyMotion" class="headerlink" title="第五节：Buff 修改运动(ModifyMotion)"></a>第五节：Buff 修改运动(ModifyMotion)</h3><p>现在的 MMO 中为了增加动作表现力，经常会有很多位移效果，如突进，翻滚，千斤坠，击退，击飞，拖拽，吸引等等。那么这些效果该如何实现呢？而且有时候会遇到各种复杂的运动打断效果，比如击飞时不能被击退，击飞过程又能被冰冻效果定住，然后又有破冰技能击退冰冻物体并解除冰冻效果。面对这些复杂的情况，我们该如何设计呢？</p>
<p>在我们的系统中，运动都是统一通过 MovementComponent 来管理。因此通过使用 MotionModifier 来与 MovementComponent 交互。MovementComponent 中有一个 CustomMotion，用来具体实现各种运动位移。具体运动实现相关细节我们将在后面的运动章节讲述。</p>
<p>在 MotionModifier 中，我们会提供一个接口 ApplyMotion(motionTypeId，priority, forceInterrupt)来向运动组件请求运动效果。同时通过设置回调 UpdateBeforeMovement 和 UpdateAfterMovement 来触发运动前和运动后的 Buff 效果。下面我们初步介绍下 ApplyMotion 函数的三个参数：</p>
<ul>
<li>motionTypeId：运动类型 id，配置项。包含运动位移参数及相关数据。</li>
<li>priority：运动优先级，每个运动都有优先级，低优先级不能打断高优先级。</li>
<li>forceInterrrupt：是否忽略优先级，强制打断当前的 Motion。</li>
</ul>
<p>通过这三个参数，我们就能实现各类打断需求了。</p>
<p>比如说击退的运动优先级是 100，击飞的运动优先级是 200。那么在击飞过程中，施加击退 Buff 调用 ApplyMotion 的时候会返回 false，这时可以销毁掉这个击退 Buff，即击飞时无法击退。如果击飞时被冰冻，且冻在半空中停止不动，那么我们就需要设计一个静止 Buff：运动优先级是 300，作用效果是速度设置为 0，不受重力影响，同时修改 Stun 状态并挂载冰冻特效。当破冰技消除冰冻效果时，则设置破冰 Buff 的位移效果为击退，设置运动优先级为 100，forceInterrupt 为 true。此时 ApplyMotion 强制打断运动，冰冻 Buff 会触发 OnMotionInterrupt 回调，在此接口中冰冻 Buff 自我销毁即可。</p>
<p>Buff 修改运动仅代表修改运动轨迹。比如说击退仅仅只是以直线移动一段距离。而击飞是以曲线移动一段距离。同理轻功的翻滚，突刺其实都与击退是相同的运动轨迹。他们都是在一定的时间内以直线到达目标地点，且都设置 Stun 状态。它们不一样的地方其实仅仅只是动画层的表现的不同。（可能策划还会设置不同的 Tag 和 ImmuneTag 标记下）</p>
<p>我们要牢牢记住，玩家看起来各种花哨的轻功击退击飞等位移效果实际上是 State+Motion+Animation 的组合。掌握住了这一点，我们就可以通过简单的组合实现各种丰富的效果了，而不会被各种花哨的效果所迷惑，以为他们都是不一样的效果，导致最后设计出无比庞杂且难以维护的系统了。</p>
<h3 id="第六节：Buff-监听事件"><a href="#第六节：Buff-监听事件" class="headerlink" title="第六节：Buff 监听事件"></a>第六节：Buff 监听事件</h3><p>Buff 可以通过监听各类事件，执行特定逻辑或者修改事件数据来实现各种效果。</p>
<p>最常见的事件监听一般有：</p>
<ul>
<li>OnAbilityExecuted，监听某个主动技能执行成功。常用于被动技能 Buff，比如说角色施法时有 10% 概率获得 30% 的攻速提升。那么我们通常是 Buff-A 监听 OnAbilityExcuted 事件，然后 10% 概率添加 Buff-B。Buff-B 的作用是修改玩家属性，增加 30% 攻速。</li>
<li>OnBeforeGiveDamage，OnAfterGiveDamage 监听我方给目标造成伤害时触发。比如说对目标造成的伤害有 10% 概率无法被闪避，那么这个效果我们就可以通过监听 OnBeforeGiveDamage 的流程来实现。当执行伤害流程时，在计算伤害前我们抛出一个事件 event。event 里面有当前伤害数据。Buff 在调用 OnBeforeGiveDamage(event)时，修改 event.Damage.DamageFlag |= DamageFlag_NotMiss，标注该伤害无法被闪避就行了。又或者如果有一个需求是给目标造成伤害后有 10% 几率触发 DOT 伤害效果，那么我们在 OnAfterGiveDamage 的时候取出 event.Target 并给这个目标加个 DOT 类 Buff 即可。</li>
<li>OnBeforeTakeDamage，OnAfterTakeDamage 监听我方受到伤害时触发。如护盾类 Buff 通常在 OnBeforeTakeDamage 的时候修改伤害数据。又或者有某些 Buff 在受到伤害后可以触发各类效果就可以通过监听 OnAfterTakeDamage 事件来触发指定逻辑。</li>
<li>OnBeforeDead，OnAfterDead 监听我方死亡时触发。如免疫致死效果可以通过监听 OnBeforeDead 事件修改角色当前的 Hp&gt;0，从而让角色提前退出死亡流程以避免死亡。死亡后触发额外效果，如爆炸或者召唤其他生物都可以通过监听 OnAfterDead 事件来执行。</li>
<li>OnKill 事件，监听我方击杀目标时触发。如当击杀目标后获得治疗效果回复即可通过监听到 Kill 事件时给自己加一个 HOT 的 Buff 来实现。</li>
</ul>
<p>开发者可以通过扩展各类事件列表，让 Buff 通过监听对应事件就能执行任意逻辑。不需要与任何模块耦合，只需要抛出事件，监听事件，执行逻辑即可获得 Buff 功能上的扩展。</p>
<h2 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h2><p>以上我们通过六个小节讲述了 Buff 系统主要模块的实现方法。通过这样的设计，我们让 Buff 的深度和扩展性都能够得到了极大的提升，几乎能实现各种各样的效果。足以让策划的创意得到最大限度的发挥。</p>
<h2 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h2><p>为了让读者便于直观理解，我会提出一些具体实现的例子以供参考：</p>
<ul>
<li><p>问：Buff 互斥效果也很常见，怎么做？</p>
</li>
<li><p>答：BuffTag 和 BuffImmuneTag 可轻松实现。比如说火系 Buff 和水系 Buff 互斥。无论策划的需求是存在水系 Buff 的时候无法添加火系 Buff，还是存在水系 Buff 的时候添加火系 Buff 会驱散水系 Buff 都可以实现。第一种情况最简单，水系 Buff 配置 Tag 为 Water 的时候配置 ImmuneTag 为 Fire。此时存在水系 Buff 的时候即可免疫火系 Buff 了。第二中情况也好办。配置 BuffTag 为 Water。当 OnBuffStart 的时候调用驱散接口 DispelByTag(Fire)，驱散掉所有火系 Tag 相关 Buff 即可。</p>
</li>
<li><p>问：霸体效果怎么实现，而且假如说存在破霸体效果又怎么实现，而且 Boss 的霸体效果完全不受影响又怎么实现？万一还存在特殊效果可以让 Boss 受到控制怎么办？</p>
</li>
<li><p>答：我们可以定义两个 BuffTag：WeakControl（弱控制）和 StrongControl(强控制），普通霸体效果通过 Buff 配置 ImmuneTag：WeakControl 即可免疫控制效果。如果是破霸体效果，我们给这个 Buff 的 Tag 标记 StrongControl 就行，同时 Boss 的 Buff 配置 ImmuneTag 为 WeakControl | StrongControl（免疫弱控制和强控制）就满足需求了。如果存在某个特殊的效果能让 Boss 受到控制效果的话，那这个 Buff 的 Tag 不要标记 WeakControl 和 StrongControl 就行了，这样它就无法被免疫掉了。看起来复杂的霸体破霸体效果实际实现就这么简单，就这么清晰，不需要引入任何新的系统。</p>
</li>
<li><p>问：Buff 存盘那块如何处理跟施法者相关的属性数据？如施法者可以给目标添加一个强力的毒 Buff，具体伤害数值有施法者属性决定，离线后依旧生效，直到 Buff 时间结束才移除。</p>
</li>
<li><p>答：这块我们的处理依旧很简单，Buff 依然设置 bNoCaster=true。但是在 Buff 创建的 Context 里面我们设置 Context.DamageValue 为根据施法者属性计算出来的伤害数值。然后 Buff 持续造成伤害的时候直接取 Context.DamageValue 即可。至于说想要玩家离线再上线，Caster 离线再上线后，毒的伤害数值还能实时修改的话，这样的需求是不存在的，如果一定要做，当然也能做，只是麻烦一点而且也没有必要。这样的需求一般仅仅存在测试的大脑中，策划是不会有这样的玩法需求了。</p>
</li>
<li><p>问：常见的基于指定地点延迟触发的 AOE 效果怎么实现？当技能施法成功后就延迟触发，不会被打断 AOE 效果。（如果能被打断，我们可以用引导类技能轻松实现）</p>
</li>
<li><p>答：我们将技能标记为可指定目标地点释放，当技能 Spell 的时候我们先给自己加一个 Buff，这个 Buff 仅仅用于延迟效果（当然可以有更多的可能性，如监听到某种事件立即结束并触发 AOE 效果），当 Buff 持续时间到了的时候在 OnBuffDestroy 的时候创建 AOE 效果 Buff。这个 AOE Buff 会调用 StartIntervalThink 函数，在 OnIntervalThink 的时候通过 Buff:GetAbility():GetCastPosition()为基准位置检查周围的敌方单位是否在 AOE 半径内，如果是，则施加作用效果。</p>
</li>
</ul>
<h1 id="5-如何实现一个强大的-MMO-技能系统——子弹"><a href="#5-如何实现一个强大的-MMO-技能系统——子弹" class="headerlink" title="5. 如何实现一个强大的 MMO 技能系统——子弹"></a>5. 如何实现一个强大的 MMO 技能系统——子弹</h1><h2 id="前言-4"><a href="#前言-4" class="headerlink" title="前言"></a>前言</h2><p>子弹又称抛射物（Projectile），是游戏中非常常见的一个概念。它常见于各大远程职业的技能效果：通过施法创建出一个带有弹道的物体，经过飞行后命中目标并触发各类效果。在游戏中，我们经常能看见各种各样复杂多变的子弹效果，那么它们是如何实现的呢？</p>
<h2 id="正文-3"><a href="#正文-3" class="headerlink" title="正文"></a>正文</h2><p>游戏，是欺骗视觉的艺术。对渲染有了解的开发者对此一定有深刻的体会，而子弹系统的实现，也正是完美的贯彻了这种理念。</p>
<p>看起来变幻莫测的子弹系统本质上只有两类：</p>
<ol>
<li>追踪子弹 (TrackingProjectile)。子弹具有一个目标 Target，它创建出来后以直线速度飞向指定目标。命中目标或者到达目标位置后调用技能执行 OnProjectileHit(projHandle, hitTarget, hitPosition) 触发效果并自我销毁，hitTarget 可为空（目标有可能在飞行途中死亡或消失）。</li>
<li>线性子弹(LinearProjectile)。子弹为等腰梯形检测盒子，无需目标，创建出来后沿着特定方向飞行一段距离。飞行途中进行相交测试(SweepTest)，对检测范围内的目标调用技能执行 OnProjectileHit 触发效果。到达目的地后触发 OnProjectileHit(此时 hitTarget 为空）并自我销毁。</li>
</ol>
<p>相信有很多开发者看到这里，可能会比较疑惑为什么没有抛物线子弹，这种像炮弹一样经过抛物线轨迹飞行，落地后会爆炸的子弹难道不是非常典型的子弹吗？然而这事实上并不需要用子弹来实现，我将在后文中讲述它的实现方式。</p>
<p>子弹系统的实现大致可以划分为如下几个流程：</p>
<h3 id="1-子弹的创建"><a href="#1-子弹的创建" class="headerlink" title="1. 子弹的创建"></a>1. 子弹的创建</h3><p>我们通过 ProjectileManager::CreateTrackingProjectile(…)和 ProjectileManager::CreateLinearProjectile(…)来创建一个子弹，它返回子弹的 Handle 以供调用方使用。</p>
<p>创建追踪子弹需要的参数主要有：</p>
<ul>
<li>Owner：表示子弹的创建者</li>
<li>Ability：表示子弹关联的技能</li>
<li>FromPosition：子弹的出发地点</li>
<li>Target：子弹追踪的目标</li>
<li>Speed：子弹的飞行速率</li>
</ul>
<p>创建线性子弹需要的参数主要有：</p>
<ul>
<li>Owner：表示子弹的创建者</li>
<li>Ability：表示子弹关联的技能</li>
<li>FromPosition：子弹的出发地点</li>
<li>Velocity：子弹的飞行速度和方向</li>
<li>StartWidth，EndWith，Distance：（等腰梯形检测盒）起点宽度，终点宽度，飞行距离</li>
<li>FilterTargetInfo：子弹筛选目标信息</li>
</ul>
<h3 id="2-子弹的位置更新"><a href="#2-子弹的位置更新" class="headerlink" title="2. 子弹的位置更新"></a>2. 子弹的位置更新</h3><p>追踪子弹基于直线速度飞向目标，运动轨迹如下图:</p>
<p><img src="/images/loading.gif" data-lazy-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="></p>
<p>线性子弹基于插值更新位置，运动轨迹如下图：</p>
<p><img src="/images/loading.gif" data-lazy-src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="></p>
<p>3. 子弹的命中处理</p>
<p>由于子弹在创建时传入了 Ability 参数，那么当子弹检测到命中目标后便可以通过调用 GetAbility().OnProjectileHit(projHandle, hitTarget, hitPosition)在 Ability Class 中执行命中逻辑，这样它就可以在技能模块中通过执行策划配置来实现各种效果了。子弹本身是没有任何特殊逻辑的，它只有位置更新，检查命中目标和是否结束并销毁这几个简单的功能。</p>
<p>子弹系统的逻辑本质上就是这么简单。当然，这并不意味着子弹系统到此就结束了。以上所讲述的仅仅是子弹的逻辑运行部分，这些过程都是完全运行在服务端的，客户端并不会收到任何消息。</p>
<h3 id="4-子弹的客户端表现"><a href="#4-子弹的客户端表现" class="headerlink" title="4. 子弹的客户端表现"></a>4. 子弹的客户端表现</h3><p>子弹系统如果仅仅包含这些逻辑代码当然是完全不够的。假如不通过某些手段将这个过程在客户端渲染出来，那么玩家感知到的情况可能就是这样的：角色抬手施法后什么也没发生，过了几秒后目标突然就受到了一个伤害。这样很明显是不符合直观感受的，那么为了让这个过程看起来合乎情理，我们就需要借助一个媒介在客户端向玩家来展示子弹的行为。</p>
<p>我们选择通过特效系统来向客户端展现绚丽的子弹效果。这就意味着整个客户端其实是没有 Projectile 这个概念的，有的只是各种各样的自定义特效。</p>
<p>开发者非常容易陷入的思维误区就是服务器与客户端子弹是一致的，它们必须有相同的逻辑。而实际上这完全没有必要。</p>
<p>比如说最常见的子弹需求：法师释放一个小火球飞向目标。如果为了让这个技能表现效果更好，我们会让火球从法师的手上（攻击挂点）创建出来，然后飞向目标的胸前（受击挂点），而且我们可能还会给火球加一些随机弧线来让每一个火球的轨迹都不一样，同时火球命中目标后还会有个火焰溅散开来的效果。</p>
<p>那么在上面的需求中，我们也需要让服务器的子弹做这些复杂的模拟吗？当然没必要了。服务器只需要创建一个线性子弹，同时告诉客户端创建一个特效：这个特效需要在施法者手部的攻击挂点位置被创建，目的点是目标的胸口受击挂点，特效的飞行速度为 N 米 / 秒。特效是纯客户端的，而且有自己的行为脚本。本例中的特效可能会挂载一个 TrackingMoveScript，它会在创建的时候读取服务器发过来的数据来确定特效的初始位置，速度和目标，同时它还有一些自己的配置参数，比如说随机弧线偏移，碰撞时是否触发其他特效等等信息。</p>
<p>这样整个的实际流程就是：</p>
<p>服务器创建追踪子弹直线飞向目标，同时告诉客户端创建火球特效并设置相关数据。子弹经过一段飞行时间命中后调用 Ability::OnProjectileHit 造成伤害。</p>
<p>客户端创建一个火球特效，特效读取数据运行自定义特效脚本，从角色手上创建出来并以不同的弧线飞向目标，命中目标后火球溅射然后飞散消失。</p>
<p>整个过程都是完全独立并行的。</p>
<p>也许会有开发者会觉得这样不就会有位置误差吗？也许服务器命中目标后客户端的火球还没有到达目标地点呢？</p>
<p>然而这并不会有什么问题。MMO 并不是格斗游戏，也不是 FPS 有爆头需求，它不需要保证严格的位置一致性，只要肉眼看起来没有明显误差就可以。事实上以正常的网速，基本不会出现不符合直观感受的情况。但是如果存在一个大型 BOSS，比如向恐龙那样身体前后很长，并且从嘴里发射子弹的话，那么此时我们就需要在子弹的创建参数 FromPosition 那里取恐龙的位置并加上 ForwardOffset 才行。</p>
<h3 id="为什么抛物线炮弹不是子弹"><a href="#为什么抛物线炮弹不是子弹" class="headerlink" title="为什么抛物线炮弹不是子弹"></a>为什么抛物线炮弹不是子弹</h3><p>我们知道游戏中发射炮弹的需求通常都是这样的：</p>
<p>有个炸弹哥布林，它的技能就是朝玩家所在的地点附近扔炮弹，炮弹落地后会发生爆炸并对周围的玩家造成一定量的伤害。</p>
<p>通常开发者第一反应就是创建个抛物线子弹，然后在飞行途中检查是否碰到了地面，如果碰撞则直接触发一个爆炸范围伤害。这样的设计是很直观的，然而游戏往往是欺骗视觉的艺术。</p>
<p>让我们再细细思考下这个技能的核心是什么？爆炸，落地的瞬间爆炸。让我们摒除画面的误导，想想如果一个技能仅仅是 N 秒后指定地点造成范围伤害，那么我们需要用到子弹吗？很明显不需要，一个 buff 延迟触发伤害就解决了。那么炮弹本质上不正是这样的逻辑吗？我们有起始点和目标点，有飞行速度，自然而然的整个炮弹的生命周期就可以求出来了。我们创建一个 Buff，设置它的持续时间为炮弹的生命周期，Buff 销毁时触发爆炸逻辑，Buff 初始化时创建一个特效，由这个特效负责在客户端去模拟抛物线运动。</p>
<p>所以在这个需求中，其实根本没有什么抛物线子弹，有的只是服务器 Buff 和客户端模拟抛物线飞行的炮弹特效。</p>
<p>同理，类似于龙持续喷火这样的技能也不需要用到子弹。服务器只需要创建一个 buff 持续触发范围伤害，同时客户端则由特效根据服务器给出的位置数据去模拟喷火效果就行了。</p>
<h2 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h2><p>在我们的系统中，子弹实际上是分为两部分。服务器逻辑层和客户端表现层，逻辑层实现简单，表现层实现复杂，由特效系统统一实现各种表现效果。同时子弹的伤害效果由技能触发，从而保证与技能系统具有一致的扩展性。</p>
<p>我们在开发的过程中不要被表面的绚丽多彩的特效迷花了双眼，应该去探求它真正的内在逻辑是怎样的。它是否真的是一个子弹，还是说仅仅只需要一个 Buff 就能实现了。</p>
<h2 id="示例-2"><a href="#示例-2" class="headerlink" title="示例"></a>示例</h2><p>我们将举出一些子弹相关的例子供大家直观理解。</p>
<p>问：闪电链这样的技能如何实现？</p>
<p>答：技能在施法（Spell）的时候的创建一个追踪子弹，目标为当前技能选择的目标 A，同时告诉客户端创建一个闪电特效（特效 Handle 由服务器创建后下发），客户端设置闪电特效的初始点为角色的手，终点为目标 A 的胸口受击点，服务器记录特效的 Handle 用于在后面更新闪电特效的位置。当追踪子弹命中目标 A 的时候，技能保存当前的目标 A 信息，同时筛选下一个其他单位 B。此时再创建一个新的追踪子弹设置起始点为当前目标 A 的位置，追踪目标为 B，并且通过特效 Handle 通知客户端更新特效的起始点为 A 的胸口受击点，终点为 B 的胸口受击点。这样依次执行，就达到闪电链的效果了。</p>
<p>问：一个技能创建多种子弹并且命中效果不一样怎么实现？</p>
<p>答：你可以在创建子弹的时候保存下子弹的 Handle，然后在 OnProjectileHit 的时候对比下 Handle，从而决定是否执行哪种效果。</p>
<p>问：如果存在一个 Buff，能够监听某个技能创建的子弹。并让该子弹在命中目标的时候有几率分叉创建出两个新的子弹怎么办？</p>
<p>答：让子弹在 Ability::OnProjectileHit 的时候抛出事件，此时 Buff 监听子弹命中事件，获取这个子弹的 Ability，检查该 Ability 是否为 Buff 指定的 Ability，如果是，则让该技能再创建出新的子弹即可。</p>
<p>问：像钩子这样能钩住人并拖回来的技能用子弹怎么实现？</p>
<p>答：技能施法时创建线性子弹向前方运动，同时创建一个钩子特效设置起始点为手，目标点为子弹终点位置，钩子以一定速度向前飞行。</p>
<p>当线性子弹飞行到终点并且没有命中到任何单位时：</p>
<p>此时创建一个新的线性子弹，初始点为终点位置，目标点为施法者位置。同时更新钩子特效的速度方向为返回方向。当线性子弹回到施法者位置后触发 OnProjectileHit，此时手动 Destroy 钩子特效。</p>
<p>当线性子弹飞行过程中命中单位时：</p>
<p>此时立即销毁该子弹并给命中目标添加一个拖拽 Buff，它修改目标的运动，让目标沿直线向施法者的位置移动，速度和钩子飞行速度一致，到达目标点后 Buff 自我销毁。子弹命中目标的同时会创建一个新的线性子弹，初始点为子弹当前位置，目标点为施法者位置，以相同的速度返回施法者位置，同时修改钩子特效参数，设置特效的末端钩子为绑定目标胸口受击点，特效速度为向施法者位置飞行。当线性子弹到达施法者的位置时销毁钩子特效。</p>
<hr>
<blockquote>
<p>参考来源：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://zhuanlan.zhihu.com/p/147681650">如何实现一个强大的 MMO 技能系统</a></p>
</blockquote>
<hr>
<blockquote>
<p>to be continued…</p>
</blockquote>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://tamsiree.com">Tamsiree</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://tamsiree.com/Game/MMO/%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E5%BC%BA%E5%A4%A7%E7%9A%84MMO%E6%8A%80%E8%83%BD%E7%B3%BB%E7%BB%9F/">https://tamsiree.com/Game/MMO/%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E5%BC%BA%E5%A4%A7%E7%9A%84MMO%E6%8A%80%E8%83%BD%E7%B3%BB%E7%BB%9F/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://tamsiree.com" target="_blank">Tamsiree</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Game/">Game</a></div><div class="post-share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/Tamsiree/Assets@master/Picture/Blog/Cover/bg-b14c061.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/Tamsiree/Assets@master/Function/qrcode_wechat.jpg" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src="/images/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Tamsiree/Assets@master/Function/qrcode_wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/Tamsiree/Assets@master/Function/qrcode_alipay.jpg" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src="/images/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Tamsiree/Assets@master/Function/qrcode_alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/GameEngine/Unity/Unity%E5%B0%863D%E9%A1%B9%E7%9B%AE%E5%8D%87%E7%BA%A7%E4%B8%BAURP%E9%A1%B9%E7%9B%AE/" title="Unity 将 3D 项目升级为 URP 项目"><img class="cover" src="/images/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Tamsiree/Assets@master/Picture/Blog/Cover/bg-373df37.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Unity 将 3D 项目升级为 URP 项目</div></div><div class="info-2"><div class="info-item-1">前言在使用 Unity 的过程中，总会遇到老项目需要用到 URP 效果，故需要将 3D 项目转化为 URP 项目。 1. 安装 Universal RP在 Window 窗口下打开 Package Manager, 包的类型选择 Unity 为 Unity Registry 搜索 Universal，可以看到当前 unity 版本（2020.2）已经认证支持的 Universal RP 版本是 10.2.2。点击 install 进行安装。打开 UnityARegistry 时有时候会存在下面的报错，这是因为网络的问题，可能需要科学上网。 2. 创建渲染管线的 Pipeline点击 Project 下的加号创建新的渲染管线，Rendering -- Universal Render Pipeline -- Pipeline Asset(Forward Renderer)如下图, 使用默认的命名方式命名并把他们归纳在新的文件夹下。 点击窗口 Edit -- Project Settings 打开设置页面选择 Graphics 给可编辑渲染管线设置中添加刚才新创建的 URP Pipe...</div></div></div></a><a class="pagination-related" href="/TechnicalResearch/NuGet/NuGet%E9%85%8D%E7%BD%AE%E5%BE%AE%E8%BD%AF%E5%AE%98%E6%96%B9%E4%B8%AD%E5%9B%BD%E9%95%9C%E5%83%8F/" title="NuGet 配置微软官方中国镜像"><img class="cover" src="/images/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Tamsiree/Assets@master/Picture/Blog/Cover/54a8f54c6f210.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">NuGet 配置微软官方中国镜像</div></div><div class="info-2"><div class="info-item-1">前言NuGet 配置微软官方中国镜像 正文NuGet 微软官方中国镜像地址： https://nuget.cdn.azure.cn/v3/index.json 打开 Visual Studio =&gt; 工具 =&gt; NuGet 包管理器 =&gt; 程序包管理器设置   找到 “Net 包管理器” =&gt; “程序包源”，点击“+” 新建项，将地址 https://nuget.cdn.azure.cn/v3/index.json 填写到源上。   在搜索程序包的时候使用刚新建的配置就行了。    to be continued…  </div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/Game/%E7%8A%B6%E6%80%81%E5%90%8C%E6%AD%A5%E5%92%8C%E5%B8%A7%E5%90%8C%E6%AD%A5/" title="状态同步和帧同步"><img class="cover" src="/images/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Tamsiree/Assets@master/Picture/Blog/Cover/bg-c883ef9.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-09</div><div class="info-item-2">状态同步和帧同步</div></div><div class="info-2"><div class="info-item-1">前言所谓同步，就是要多个客户端表现效果是一致的，例如我们玩王者荣耀的时候，需要十个玩家的屏幕显示的英雄位置完全相同、技能释放角度、释放时间完全相同，这个就是同步。就好像很多个人一起跳街舞齐舞，每个人的动作都要保持一致。而对于大多数游戏，不仅客户端的表现要一致，而且需要客户端和服务端的数据是一致的。所以，同步是一个网络游戏概念，只有网络游戏才需要同步，而单机游戏是不需要同步的。 正文一、状态同步和帧同步的区别 最大的区别就是战斗核心逻辑写在哪，状态同步的战斗逻辑在服务端，帧同步的战斗逻辑在客户端。战斗逻辑是包括技能逻辑、普攻、属性、伤害、移动、AI、检测、碰撞等等的一系列内容，这常常也被视为游戏开发过程中最难的部分。由于核心逻辑必须知道一个场景中的所有实体情况，所以 MMO 游戏（例如魔兽世界）就必须把战斗逻辑写在服务端，所以 MMO 游戏必须是状态同步的，因为 MMO 游戏的客户端承载有限，并不能把整张地图的实体全部展现出来（例如 100 米以外的 NPC 和玩家就不显示了），所以客户端没有足够的信息计算全图的人的所有行为。 具体到客户端和服务端通信上，在状态同步下，客户端更像是...</div></div></div></a><a class="pagination-related" href="/Game/GamePlatform/Steam/ARK/" title="ARK"><img class="cover" src="/images/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Tamsiree/Assets@master/Picture/Blog/Cover/wallhaven2krer9.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-01-03</div><div class="info-item-2">ARK</div></div><div class="info-2"><div class="info-item-1">前言ARK 全名是 ARK: Survival Evolved，中文名为 方舟：生存进化，是由独立工作室 Wildcard 旗下由虚幻引擎 4（Unreal Engine 4）打造的生存类开放世界游戏。   背景描述游戏故事主要讲述，一群人醒来便出现在神秘海滩，为了生存而探索远古开放世界，玩家需要通过合作 / 竞技来获取生活必需品。人类需要打猎、收获、研究技术，甚至要根据动态天气变化（酷热白昼、冰冷夜晚）搭建住处，而危险的远古动物会随机出现威胁人类生存。此外玩家们还需要通过策略战术来驯服游戏中出现的各种恐龙和其他原始生物，并利用他们来跨越海陆空甚至进入地下世界。玩家们可以利用本作中深入的角色扮演系统来充分打造自己角色的长处，并获得各种物品和宠物等。玩家们还要同数以百计的其他玩家部落展开生存竞争，并最终发现 “方舟(ARK)” 的真正目的。 正文生物根据动物的食性给予被击晕的动物不同类型的食物便可以将其驯服，部分无法驯服；被驯服的动物可以更改其攻击方式，比如主动攻击，被动防御之类，还可以为玩家取一部分物品，以及供玩家骑乘。部分地区必须依靠骑乘能力不同的动物才能到达。 野生的动物、恐...</div></div></div></a><a class="pagination-related" href="/Game/GamePlatform/Lutris/Lutris%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/" title="Lutris 使用技巧"><img class="cover" src="/images/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Tamsiree/Assets@master/Picture/Blog/Cover/wallhaveng8171e.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-01-15</div><div class="info-item-2">Lutris 使用技巧</div></div><div class="info-2"><div class="info-item-1">前言Lutris 是 Linux 的开放式游戏平台。它可以帮助您在统一界面中安装和管理游戏。其目标是支持在 Linux 上运行的所有游戏，从原生到 Windows 游戏（通过 Wine）到模拟器和浏览器游戏。 正文在 Lutris 中的配置优先级：游戏运行配置 &gt; 运行环境配置 &gt; Lutris 系统配置。   运行战网在 Lutris 上运行战网，需要在设置中调整部分选项。        to be continued…  </div></div></div></a><a class="pagination-related" href="/Game/%E7%83%AD%E8%A1%80%E4%BC%A0%E5%A5%87/%E7%83%AD%E8%A1%80%E4%BC%A0%E5%A5%87/" title="热血传奇"><img class="cover" src="/images/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Tamsiree/Assets@master/Picture/Blog/Cover/1Z411101210-6-1200.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-05-11</div><div class="info-item-2">热血传奇</div></div><div class="info-2"><div class="info-item-1">前言千言万语涌上心头，只为情怀二字。 正文装备属性物品大全盔甲** 各职业通用盔甲：**      图片 名称 需要等级 攻击 魔法 道术 防御 魔防 持久 重量 附加属性     布衣 1    2-2 0-1 5 5     轻型盔甲 11    3-3 1-2 8 8     中型盔甲 16    3-5 1-2 12 12    ** 战士盔甲：**      图片 名称 需要等级 攻击 魔法 道术 防御 魔防 持久 重量 附加属性     重盔甲 22    4-7 2-3 25 23     战神盔甲 攻击力 46    5-9 3-5 30 45     天魔神甲 40 1-2   5-12 4-7 35 62     圣战宝甲 40 1-2   5-12 4-7 35 62    ** 道士盔甲：**      图片 名称 需要等级 攻击 魔法 道术 防御 魔防 持久 重量 附加属性     灵魂战衣 22   0-2 3-6 3-3 20 15     幽灵战衣 精神力 27   1-4 4-7 3-4 28 26     天尊道袍 40   2-5 4-9 4...</div></div></div></a><a class="pagination-related" href="/Game/GamePlatform/Steam/CSGO/CSGO/" title="CSGO"><img class="cover" src="/images/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Tamsiree/Assets@master/Picture/Blog/Cover/thumb-350-570417.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2018-12-18</div><div class="info-item-2">CSGO</div></div><div class="info-2"><div class="info-item-1">前言 显示 FPS 开启控制台游戏开始界面 - “选项” - “游戏设置”   找到“启用开发者控制台(~)”，选择“是”  之后，在游戏中只要按 “~” 按键 (Esc 下面) 即可开启控制台   显示帧数 (FPS) 及网络参数(PING、LOSS、CHOKE 等)  12&gt; net_graph 1 开启帧数、网络参数显示  &gt; net_graph 0 关闭     在控制台输入 “net_graph 1” 后回车即可在右下角显示帧数 (FPS) 及网络参数(PING、LOSS、CHOKE 等)    修改参数显示位置(左、中、右)  123&gt; net_graphpos 0 参数显示在界面左边  &gt; net_graphpos 1 参数显示在界面右边  &gt; net_graphpos 2 参数显示在界面中间     使用方法同上，控制台输入即可，下图是 net_graphpos 0 效果      修改参数显示位置高度(详细到像素)  1&gt; net_graphheight 数值，数值越大，位置越高     下图为 net_graphheight...</div></div></div></a><a class="pagination-related" href="/Game/%E9%AD%94%E5%85%BD%E4%B8%96%E7%95%8C/%E9%AD%94%E5%85%BD%E4%B8%96%E7%95%8C%E6%88%98%E6%96%97%E7%B3%BB%E7%BB%9F/" title="魔兽世界战斗系统"><img class="cover" src="/images/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Tamsiree/Assets@master/Picture/Blog/Cover/U11770P115DT20151126132920.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-06-08</div><div class="info-item-2">魔兽世界战斗系统</div></div><div class="info-2"><div class="info-item-1">《魔兽世界》战斗系统数值分析：伤害公式与战斗机制 ** 一、属性概述：**   **1. 基础属性 **   生命值：最大生命值上限，受到耐力的加成   法力值：最大法力值上限，以前版本受智力加成，现在为按等级固定   力量：提高攻击强度   敏捷：提高物理暴击概率，某些职业（盗贼、猎人等）提供攻击强度   耐力：提高生命值   智力：提高法术强度和法术暴击率   精神：提高法力回复速度   **2. 物理输出进阶属性 **   伤害：即 DPH，浮动值，表单次攻击伤害的高低   攻击强度：受力量、敏捷加成，可看作人物自身的攻击力   攻击速度：普通攻击的攻击速度   急速：影响攻击施法速度，急速越高攻击越快   命中率：增加命中率的百分比，抵消玩家的未命中率   暴击率：受敏捷加成，暴击可以造成 2 倍伤害   精准：精准可以降低对方躲闪招架你攻击的概率   **3. 法系输出进阶属性 **   法术强度：决定法术伤害的高低，主要由智力提供   急速：影响施法速度，急速越高施法越快，DOT 型法术每条之间的时间越短   命中率：增加法术命中率，抵消玩家的法术未命中率   法力回...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/images/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Tamsiree/Assets@master/Avatar/avatar_sky_circle.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Tamsiree</div><div class="author-info-description">勇于尝试才有可能迈向成功</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">201</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">140</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">143</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/tamsiree"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Tamsiree" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github-square"></i></a><a class="social-icon" href="mailto:tamsiree.com@gmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope-square"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss-square"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">只有用心灵才能看得清事物的本质，真正重要的东西是肉眼无法看见的。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E5%BC%BA%E5%A4%A7%E7%9A%84-MMO-%E6%8A%80%E8%83%BD%E7%B3%BB%E7%BB%9F%E2%80%94%E2%80%94%E5%BA%8F%E7%AB%A0"><span class="toc-number">1.</span> <span class="toc-text">1. 如何实现一个强大的 MMO 技能系统——序章</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.1.</span> <span class="toc-text">前言</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E5%BC%BA%E5%A4%A7%E7%9A%84-MMO-%E6%8A%80%E8%83%BD%E7%B3%BB%E7%BB%9F%E2%80%94%E2%80%94AOI"><span class="toc-number">2.</span> <span class="toc-text">2. 如何实现一个强大的 MMO 技能系统——AOI</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-1"><span class="toc-number">2.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E6%96%87"><span class="toc-number">2.2.</span> <span class="toc-text">正文</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">2.3.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E5%BC%BA%E5%A4%A7%E7%9A%84-MMO-%E6%8A%80%E8%83%BD%E7%B3%BB%E7%BB%9F%E2%80%94%E2%80%94%E6%8A%80%E8%83%BD"><span class="toc-number">3.</span> <span class="toc-text">3. 如何实现一个强大的 MMO 技能系统——技能</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-2"><span class="toc-number">3.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E6%96%87-1"><span class="toc-number">3.2.</span> <span class="toc-text">正文</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-number">3.3.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">3.4.</span> <span class="toc-text">示例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E5%BC%BA%E5%A4%A7%E7%9A%84-MMO-%E6%8A%80%E8%83%BD%E7%B3%BB%E7%BB%9F%E2%80%94%E2%80%94BUFF"><span class="toc-number">4.</span> <span class="toc-text">4. 如何实现一个强大的 MMO 技能系统——BUFF</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-3"><span class="toc-number">4.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E6%96%87-2"><span class="toc-number">4.2.</span> <span class="toc-text">正文</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E8%8A%82%EF%BC%9ABuff-%E5%AE%9A%E4%B9%89"><span class="toc-number">4.2.1.</span> <span class="toc-text">第一节：Buff 定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E8%8A%82%EF%BC%9ABuff-%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">4.2.2.</span> <span class="toc-text">第二节：Buff 执行流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E8%8A%82%EF%BC%9ABuff-%E4%BF%AE%E6%94%B9%E7%8A%B6%E6%80%81%EF%BC%88ModifyState"><span class="toc-number">4.2.3.</span> <span class="toc-text">第三节：Buff 修改状态（ModifyState)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E8%8A%82%EF%BC%9ABuff-%E4%BF%AE%E6%94%B9%E5%B1%9E%E6%80%A7-ModifyAttribute"><span class="toc-number">4.2.4.</span> <span class="toc-text">第四节：Buff 修改属性(ModifyAttribute)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E8%8A%82%EF%BC%9ABuff-%E4%BF%AE%E6%94%B9%E8%BF%90%E5%8A%A8-ModifyMotion"><span class="toc-number">4.2.5.</span> <span class="toc-text">第五节：Buff 修改运动(ModifyMotion)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E8%8A%82%EF%BC%9ABuff-%E7%9B%91%E5%90%AC%E4%BA%8B%E4%BB%B6"><span class="toc-number">4.2.6.</span> <span class="toc-text">第六节：Buff 监听事件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-2"><span class="toc-number">4.3.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-1"><span class="toc-number">4.4.</span> <span class="toc-text">示例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E5%BC%BA%E5%A4%A7%E7%9A%84-MMO-%E6%8A%80%E8%83%BD%E7%B3%BB%E7%BB%9F%E2%80%94%E2%80%94%E5%AD%90%E5%BC%B9"><span class="toc-number">5.</span> <span class="toc-text">5. 如何实现一个强大的 MMO 技能系统——子弹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-4"><span class="toc-number">5.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E6%96%87-3"><span class="toc-number">5.2.</span> <span class="toc-text">正文</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AD%90%E5%BC%B9%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="toc-number">5.2.1.</span> <span class="toc-text">1. 子弹的创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AD%90%E5%BC%B9%E7%9A%84%E4%BD%8D%E7%BD%AE%E6%9B%B4%E6%96%B0"><span class="toc-number">5.2.2.</span> <span class="toc-text">2. 子弹的位置更新</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%AD%90%E5%BC%B9%E7%9A%84%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%A1%A8%E7%8E%B0"><span class="toc-number">5.2.3.</span> <span class="toc-text">4. 子弹的客户端表现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%8A%9B%E7%89%A9%E7%BA%BF%E7%82%AE%E5%BC%B9%E4%B8%8D%E6%98%AF%E5%AD%90%E5%BC%B9"><span class="toc-number">5.2.4.</span> <span class="toc-text">为什么抛物线炮弹不是子弹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-3"><span class="toc-number">5.3.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-2"><span class="toc-number">5.4.</span> <span class="toc-text">示例</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/%E9%9A%8F%E6%89%8B%E8%AE%B0/Hexo%E4%B8%ADWaline%E6%95%85%E9%9A%9C%E4%BF%AE%E5%A4%8D%E6%8C%87%E5%8D%97/" title="Hexo 中 Waline 故障修复指南"><img src="/images/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Tamsiree/Assets@master/DeskTop/Konachan.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hexo 中 Waline 故障修复指南"/></a><div class="content"><a class="title" href="/%E9%9A%8F%E6%89%8B%E8%AE%B0/Hexo%E4%B8%ADWaline%E6%95%85%E9%9A%9C%E4%BF%AE%E5%A4%8D%E6%8C%87%E5%8D%97/" title="Hexo 中 Waline 故障修复指南">Hexo 中 Waline 故障修复指南</a><time datetime="2026-02-05T07:25:41.000Z" title="发表于 2026-02-05 15:25:41">2026-02-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E6%B8%B8%E6%88%8F/%E7%8B%AC%E7%AB%8B%E6%B8%B8%E6%88%8F/%E7%8B%AC%E7%AB%8B%E6%B8%B8%E6%88%8F%E7%9A%84%E6%88%90%E5%8A%9F%E4%B9%8B%E6%AF%8D/" title="独立游戏的成功之母"><img src="/images/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Tamsiree/Assets@master/Picture/Blog/Cover/552b1999aa4d5a2e75352fa2f6e93d51.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="独立游戏的成功之母"/></a><div class="content"><a class="title" href="/%E6%B8%B8%E6%88%8F/%E7%8B%AC%E7%AB%8B%E6%B8%B8%E6%88%8F/%E7%8B%AC%E7%AB%8B%E6%B8%B8%E6%88%8F%E7%9A%84%E6%88%90%E5%8A%9F%E4%B9%8B%E6%AF%8D/" title="独立游戏的成功之母">独立游戏的成功之母</a><time datetime="2025-11-11T05:08:38.000Z" title="发表于 2025-11-11 13:08:38">2025-11-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Docker/MongoDB/Docker%E4%B8%ADMongoDB%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D/" title="Docker 中 MongoDB 数据库的备份与恢复"><img src="/images/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Tamsiree/Assets@master/Picture/Blog/Cover/cdd893c83169033d6b4a8354f1ab9d37.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker 中 MongoDB 数据库的备份与恢复"/></a><div class="content"><a class="title" href="/Docker/MongoDB/Docker%E4%B8%ADMongoDB%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D/" title="Docker 中 MongoDB 数据库的备份与恢复">Docker 中 MongoDB 数据库的备份与恢复</a><time datetime="2025-11-06T00:49:58.000Z" title="发表于 2025-11-06 08:49:58">2025-11-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E9%9A%8F%E6%89%8B%E8%AE%B0/Unity%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%B8%B2%E6%9F%93%E5%AF%BC%E8%87%B4%E9%83%A8%E5%88%86%E6%89%8B%E6%9C%BA%E5%B4%A9%E6%BA%83/" title="Unity 多线程渲染导致部分手机崩溃"><img src="/images/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Tamsiree/Assets@master/Picture/Blog/Cover/9408053447.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Unity 多线程渲染导致部分手机崩溃"/></a><div class="content"><a class="title" href="/%E9%9A%8F%E6%89%8B%E8%AE%B0/Unity%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%B8%B2%E6%9F%93%E5%AF%BC%E8%87%B4%E9%83%A8%E5%88%86%E6%89%8B%E6%9C%BA%E5%B4%A9%E6%BA%83/" title="Unity 多线程渲染导致部分手机崩溃">Unity 多线程渲染导致部分手机崩溃</a><time datetime="2023-11-09T11:55:51.000Z" title="发表于 2023-11-09 19:55:51">2023-11-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E9%9A%8F%E6%89%8B%E8%AE%B0/%E5%A5%BD%E7%94%A8%E7%9A%84CDN%E4%B9%8BjsDelivr/" title="好用的 CDN 之 jsDelivr"><img src="/images/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/Tamsiree/Assets@master/DeskTop/20b24a69649941669d83bb997b01fed6.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="好用的 CDN 之 jsDelivr"/></a><div class="content"><a class="title" href="/%E9%9A%8F%E6%89%8B%E8%AE%B0/%E5%A5%BD%E7%94%A8%E7%9A%84CDN%E4%B9%8BjsDelivr/" title="好用的 CDN 之 jsDelivr">好用的 CDN 之 jsDelivr</a><time datetime="2023-10-16T07:00:56.000Z" title="发表于 2023-10-16 15:00:56">2023-10-16</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2016 - 2026 By Tamsiree</span></div><div class="footer_custom_text">不要盯着我看，已经到底啦～</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.3"></script><script src="/js/main.js?v=5.5.3"></script><script src="/js/tw_cn.js?v=5.5.3"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.7/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  let initFn = window.walineFn || null
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = {"placeholder":"留下你的脚印与心声~","pageSize":10,"lang":"zh-CN","requiredFields":["nick"],"avatar":"wavatar"}

  const destroyWaline = ele => ele.destroy()

  const initWaline = (Fn, el = document, path = window.location.pathname) => {
    const waline = Fn({
      el: el.querySelector('#waline-wrap'),
      serverURL: 'https://comment.tamsiree.com',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      comment: false,
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    if (isShuoshuo) {
      window.shuoshuoComment.destroyWaline = () => {
        destroyWaline(waline)
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const loadWaline = (el, path) => {
    if (initFn) initWaline(initFn, el, path)
    else {
      btf.getCSS('https://cdn.jsdelivr.net/npm/@waline/client@3.8.0/dist/waline.min.css')
        .then(() => import('https://cdn.jsdelivr.net/npm/@waline/client@3.8.0/dist/waline.min.js'))
        .then(({ init }) => {
          initFn = init || Waline.init
          initWaline(initFn, el, path)
          window.walineFn = initFn
        })
    }
  }

  if (isShuoshuo) {
    'Waline' === 'Waline'
      ? window.shuoshuoComment = { loadComment: loadWaline } 
      : window.loadOtherComment = loadWaline
    return
  }

  if ('Waline' === 'Waline' || !true) {
    if (true) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script></div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8688374801147098" crossorigin="anonymous"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索文章" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.3"></script></div></div></body></html>